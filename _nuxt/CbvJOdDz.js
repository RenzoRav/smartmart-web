import{_ as j,e as F,p as q,r as d,g as S,f as O,c as G,a as i,b as r,h as a,w as s,o as H,d as v,t as f}from"#entry";import J from"./DD2qQycl.js";import u from"./BQz5Vwi_.js";import p from"./Bq2pbc1y.js";import Q from"./DhDNEnE0.js";import V from"./B_p5YFW3.js";import B from"./BCUjEuon.js";import W from"./lc9TpMTh.js";import X from"./qTLsQgqi.js";import Y from"./yc0ifDaG.js";import Z from"./DnN3s99Q.js";import ee from"./NDFfCbvq.js";import{u as oe}from"./NV_IPBJU.js";import{u as te}from"./ENU34LCR.js";import"./CSQXBnP7.js";import"./B8EF_KF5.js";import"./vmQW3Ir0.js";import"./78XFv97U.js";import"./BDJlFfOO.js";import"./CkvWrF-X.js";import"./BrZ4R6i-.js";import"./BSONcgAy.js";import"./jc0MLXVe.js";import"./Bw4qCRz7.js";import"./CLs7nh7g.js";import"./BBwxp7DA.js";import"./0leCDpo6.js";import"./CqWfnscF.js";import"./5MdJC5N0.js";import"./CoLlQPlp.js";import"./CHHeVdlX.js";import"./Cei_Azhi.js";import"./B7vGS5x1.js";import"./BTAX5_q6.js";import"./CJNK_OEZ.js";import"./60u9rO5t.js";import"./D_SYk5Yd.js";import"./ZhWAdK_X.js";import"./B4fJAez9.js";import"./B9cle0o0.js";import"./BTHrrjOC.js";import"./DnPw_2K1.js";import"./ByRvq9lQ.js";import"./gPgZW9Jk.js";import"./BZmF0YU-.js";import"./BhIdB9yW.js";import"./DEj1BPjW.js";import"./DL66d3kA.js";import"./D2oKIKod.js";import"./Dlgc9DXr.js";import"./Cvz18dE1.js";import"./CUFmKAPc.js";const re={class:"max-w-none mx-auto px-8"},ae={class:"flex items-center justify-between mb-5"},le={class:"flex items-center gap-2"},ie={class:"flex gap-2"},se={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ue={class:"md:col-span-2"},de={class:"flex items-center gap-2 mt-2"},ne={class:"flex justify-end gap-2"},me={__name:"index",setup(ce){const m=F(),$=q(),N=oe(),{listar:P,criar:_,atualizar:E,excluir:U}=te(),y=d(!1),g=d([]),b=d(""),n=d(!1),c=d(!1),x=d([]),L=S(()=>{const o=new Map;for(const e of x.value)o.set(e.id,e.nome);return o}),k=()=>({id:null,sku:"",nome:"",preco:0,custo:0,ativo:!0,categoria_id:null}),l=d(k());function h(o){if(!o)return"—";try{return new Intl.DateTimeFormat("pt-BR",{dateStyle:"short",timeStyle:"short"}).format(new Date(o))}catch{return o}}const R=S(()=>{const o=b.value.trim().toLowerCase();return o?g.value.filter(e=>[e.nome,e.sku].some(t=>String(t||"").toLowerCase().includes(o))):g.value});async function I(){const{data:o,error:e}=await N.from("categorias").select("id, nome").order("nome",{ascending:!0});if(e)throw e;x.value=o||[]}async function w(){try{y.value=!0,await I(),g.value=await P()}catch(o){C("Falha ao carregar produtos",o)}finally{y.value=!1}}function A(){c.value=!1,l.value=k(),n.value=!0}function D(o){c.value=!0,l.value={id:o.id,sku:o.sku||"",nome:o.nome||"",preco:Number(o.preco||0),custo:Number(o.custo||0),ativo:!!o.ativo,categoria_id:o.categoria_id??o.categoriaId??null},n.value=!0}async function K(){try{const o={sku:String(l.value.sku||"").trim(),nome:String(l.value.nome||"").trim(),preco:Number(l.value.preco||0),custo:Number(l.value.custo||0),ativo:!!l.value.ativo,categoria_id:l.value.categoria_id??null};if(!o.nome){m.add({severity:"warn",summary:"Atenção",detail:"Informe o nome do produto.",life:3e3});return}c.value&&l.value.id?(await E(l.value.id,o),m.add({severity:"success",summary:"Atualizado",detail:"Produto atualizado com sucesso.",life:2500})):(await _(o),m.add({severity:"success",summary:"Criado",detail:"Produto criado com sucesso.",life:2500})),n.value=!1,await w()}catch(o){C("Erro ao salvar produto",o)}}function M(o){$.require({message:`Excluir o produto "${o.nome}"?`,header:"Confirmar exclusão",icon:"pi pi-exclamation-triangle",acceptLabel:"Excluir",rejectLabel:"Cancelar",acceptClass:"p-button-danger",accept:async()=>{try{await U(o.id),m.add({severity:"success",summary:"Excluído",detail:"Produto removido.",life:2500}),await w()}catch(e){C("Erro ao excluir produto",e)}}})}function C(o,e){const t=e?.response?.data?.message||e?.message||"Tente novamente.";m.add({severity:"error",summary:"Erro",detail:`${o}: ${t}`,life:4e3}),console.error(e)}function z(o){return L.value.get(o)||"Sem categoria"}return O(w),(o,e)=>(H(),G("div",re,[i("div",ae,[e[9]||(e[9]=i("h1",{class:"text-2xl font-bold"},"Produtos",-1)),i("div",le,[r(a(V),{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=t=>b.value=t),placeholder:"Buscar por nome ou SKU",class:"w-72 md:w-96"},null,8,["modelValue"]),r(a(p),{label:"Novo produto",icon:"pi pi-plus",onClick:A})])]),r(a(J),{value:R.value,loading:y.value,dataKey:"id",paginator:"",rows:10,rowsPerPageOptions:[10,20,50,100],size:"small",class:"shadow-sm rounded-lg w-full",style:{width:"100%"}},{default:s(()=>[r(a(u),{field:"id",header:"ID",style:{width:"90px"}}),r(a(u),{field:"sku",header:"SKU",style:{width:"160px"}}),r(a(u),{field:"nome",header:"Nome"}),r(a(u),{header:"Categoria",style:{width:"200px"}},{body:s(({data:t})=>[v(f(z(t.categoria_id??t.categoriaId)),1)]),_:1}),r(a(u),{header:"Preço",style:{width:"140px"}},{body:s(({data:t})=>[v(f(Number(t.preco??0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})),1)]),_:1}),r(a(u),{header:"Custo",style:{width:"140px"}},{body:s(({data:t})=>[v(f(Number(t.custo??0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})),1)]),_:1}),r(a(u),{header:"Status",style:{width:"120px"}},{body:s(({data:t})=>[r(a(Y),{value:t.ativo?"Ativo":"Inativo",severity:t.ativo?"success":"danger"},null,8,["value","severity"])]),_:1}),r(a(u),{header:"Criado em",style:{width:"190px"}},{body:s(({data:t})=>[v(f(h(t.criadoEm??t.criado_em)),1)]),_:1}),r(a(u),{header:"Ações",style:{width:"180px"}},{body:s(({data:t})=>[i("div",ie,[r(a(p),{icon:"pi pi-pencil",severity:"secondary",outlined:"",onClick:T=>D(t)},null,8,["onClick"]),r(a(p),{icon:"pi pi-trash",severity:"danger",outlined:"",onClick:T=>M(t)},null,8,["onClick"])])]),_:1})]),_:1},8,["value","loading"]),r(a(Q),{visible:n.value,"onUpdate:visible":e[8]||(e[8]=t=>n.value=t),header:c.value?"Editar produto":"Novo produto",modal:"",class:"w-full md:w-2/3 lg:w-1/2"},{footer:s(()=>[i("div",ne,[r(a(p),{label:"Cancelar",severity:"secondary",outlined:"",onClick:e[7]||(e[7]=t=>n.value=!1)}),r(a(p),{label:c.value?"Salvar":"Criar",icon:"pi pi-check",onClick:K},null,8,["label"])])]),default:s(()=>[i("div",se,[i("div",null,[e[10]||(e[10]=i("label",{class:"block text-sm mb-1"},"SKU",-1)),r(a(V),{modelValue:l.value.sku,"onUpdate:modelValue":e[1]||(e[1]=t=>l.value.sku=t),modelModifiers:{trim:!0},placeholder:"SKU"},null,8,["modelValue"])]),i("div",ue,[e[11]||(e[11]=i("label",{class:"block text-sm mb-1"},"Nome",-1)),r(a(V),{modelValue:l.value.nome,"onUpdate:modelValue":e[2]||(e[2]=t=>l.value.nome=t),modelModifiers:{trim:!0},placeholder:"Nome do produto"},null,8,["modelValue"])]),i("div",null,[e[12]||(e[12]=i("label",{class:"block text-sm mb-1"},"Preço",-1)),r(a(B),{modelValue:l.value.preco,"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.preco=t),mode:"currency",currency:"BRL",locale:"pt-BR",min:0},null,8,["modelValue"])]),i("div",null,[e[13]||(e[13]=i("label",{class:"block text-sm mb-1"},"Custo",-1)),r(a(B),{modelValue:l.value.custo,"onUpdate:modelValue":e[4]||(e[4]=t=>l.value.custo=t),mode:"currency",currency:"BRL",locale:"pt-BR",min:0},null,8,["modelValue"])]),i("div",null,[e[14]||(e[14]=i("label",{class:"block text-sm mb-1"},"Categoria",-1)),r(a(X),{modelValue:l.value.categoria_id,"onUpdate:modelValue":e[5]||(e[5]=t=>l.value.categoria_id=t),options:x.value,optionLabel:"nome",optionValue:"id",placeholder:"Selecione uma categoria",class:"w-full"},null,8,["modelValue","options"])]),i("div",de,[r(a(W),{modelValue:l.value.ativo,"onUpdate:modelValue":e[6]||(e[6]=t=>l.value.ativo=t),binary:!0,"input-id":"ativo"},null,8,["modelValue"]),e[15]||(e[15]=i("label",{for:"ativo"},"Ativo",-1))])])]),_:1},8,["visible","header"]),r(a(Z)),r(a(ee))]))}},co=j(me,[["__scopeId","data-v-005f4654"]]);export{co as default};
