import{_ as V,e as j,r as w,f as F,g as d,c as G,a as r,b as s,t as u,w as i,h as a,o as K,d as p,n as O}from"#entry";import v from"./D61cYkDh.js";import h from"./DD2qQycl.js";import l from"./BQz5Vwi_.js";import U from"./yc0ifDaG.js";import H from"./NDFfCbvq.js";import{u as J}from"./NV_IPBJU.js";import"./vmQW3Ir0.js";import"./CSQXBnP7.js";import"./B8EF_KF5.js";import"./78XFv97U.js";import"./BDJlFfOO.js";import"./CkvWrF-X.js";import"./BrZ4R6i-.js";import"./BSONcgAy.js";import"./jc0MLXVe.js";import"./Bw4qCRz7.js";import"./CLs7nh7g.js";import"./BBwxp7DA.js";import"./0leCDpo6.js";import"./CqWfnscF.js";import"./5MdJC5N0.js";import"./CoLlQPlp.js";import"./CHHeVdlX.js";import"./Cei_Azhi.js";import"./B_p5YFW3.js";import"./60u9rO5t.js";import"./D_SYk5Yd.js";import"./ZhWAdK_X.js";import"./B7vGS5x1.js";import"./BTAX5_q6.js";import"./CJNK_OEZ.js";import"./BCUjEuon.js";import"./DL66d3kA.js";import"./D2oKIKod.js";import"./B4fJAez9.js";import"./B9cle0o0.js";import"./BTHrrjOC.js";import"./Bq2pbc1y.js";import"./BhIdB9yW.js";import"./lc9TpMTh.js";import"./Dlgc9DXr.js";import"./DnPw_2K1.js";import"./ByRvq9lQ.js";import"./gPgZW9Jk.js";import"./BZmF0YU-.js";import"./Cvz18dE1.js";import"./CUFmKAPc.js";const L={class:"px-6 py-4 space-y-6"},W={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},X={class:"text-3xl font-semibold"},Y={class:"text-3xl font-semibold"},Z={class:"text-3xl font-semibold"},tt={class:"text-slate-500 text-sm mt-1"},ot={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},N=30,et={__name:"home",setup(st){const T=j(),b=J(),f=w(!1),g=w([]),_=w([]),I=new Date,E=new Date(I.getTime()-N*24*60*60*1e3);function k(o){if(!o)return"—";try{return new Intl.DateTimeFormat("pt-BR",{dateStyle:"short",timeStyle:"short"}).format(new Date(o))}catch{return String(o)}}function C(o){return o==="ENTRADA"?"success":o==="SAIDA"?"danger":"secondary"}async function $(){try{f.value=!0;const{data:o,error:t}=await b.from("produtos").select("id, nome, sku, ativo, categoria:categorias(nome)"),{data:e,error:n}=await b.from("movimentos_estoque").select("id, produto_id, quantidade, motivo, tipo, criado_em").gte("criado_em",E.toISOString()).order("criado_em",{ascending:!1}).limit(1e3);if(t)throw t;if(n)throw n;g.value=o||[],_.value=e||[]}catch(o){T.add({severity:"error",summary:"Erro",detail:`Falha ao carregar o dashboard: ${o.message||o}`,life:5e3})}finally{f.value=!1}}F($);const D=d(()=>g.value.length),P=d(()=>g.value.filter(o=>o.ativo).length),z=d(()=>D.value-P.value),B=d(()=>{const o=new Map;for(const t of g.value){const e=t?.categoria?.nome||"Sem categoria";o.set(e,(o.get(e)||0)+1)}return Array.from(o.entries()).map(([t,e])=>({nome:t,quantidade:e})).sort((t,e)=>e.quantidade-t.quantidade)}),M=d(()=>{const o=new Map;for(const t of g.value)o.set(t.id,t);return o}),y=d(()=>{const o=new Map,t=new Map;let e=0,n=0;for(const c of _.value){const x=Number(c.quantidade||0),m=c.produto_id;o.has(m)||(o.set(m,0),t.set(m,0)),c.motivo==="ENTRADA"?(o.set(m,o.get(m)+x),e+=x):c.motivo==="SAIDA"&&(o.set(m,o.get(m)-x),n+=x),t.set(m,t.get(m)+Math.abs(x))}return{saldosPorProduto:o,totalMovimentadoAbsoluto:t,totalEntradas:e,totalSaidas:n}}),S=d(()=>y.value.totalEntradas),A=d(()=>y.value.totalSaidas),q=d(()=>S.value-A.value),R=d(()=>{const o=[],{totalMovimentadoAbsoluto:t}=y.value;for(const[e,n]of t.entries()){const c=M.value.get(e);c&&o.push({id:e,nome:c.nome,sku:c.sku,total:n})}return o.sort((e,n)=>n.total-e.total).slice(0,5)}),Q=d(()=>_.value.slice(0,10).map(o=>({...o,nome_do_produto:M.value.get(o.produto_id)?.nome??`#${o.produto_id}`})));return(o,t)=>(K(),G("div",L,[r("div",{class:"flex items-center justify-between"},[t[0]||(t[0]=r("h1",{class:"text-2xl font-bold"},"Dashboard",-1)),r("small",{class:"text-slate-500"},"Últimos "+u(N)+" dias")]),r("div",W,[s(a(v),null,{title:i(()=>[...t[1]||(t[1]=[p("Total de Produtos",-1)])]),content:i(()=>[r("div",X,u(D.value),1),t[2]||(t[2]=r("div",{class:"text-slate-500 text-sm mt-1"},"itens cadastrados",-1))]),_:1}),s(a(v),null,{title:i(()=>[...t[3]||(t[3]=[p("Ativos",-1)])]),content:i(()=>[r("div",Y,u(P.value),1),t[4]||(t[4]=r("div",{class:"text-slate-500 text-sm mt-1"},"disponíveis",-1))]),_:1}),s(a(v),null,{title:i(()=>[...t[5]||(t[5]=[p("Inativos",-1)])]),content:i(()=>[r("div",Z,u(z.value),1),t[6]||(t[6]=r("div",{class:"text-slate-500 text-sm mt-1"},"ocultos ou bloqueados",-1))]),_:1}),s(a(v),null,{title:i(()=>[...t[7]||(t[7]=[p("Saldo no período",-1)])]),content:i(()=>[r("div",{class:O(["text-3xl font-semibold",q.value>=0?"text-emerald-600":"text-rose-600"])},u(q.value),3),r("div",tt," Entradas: "+u(S.value)+" • Saídas: "+u(A.value),1)]),_:1})]),r("div",ot,[s(a(v),null,{title:i(()=>[...t[8]||(t[8]=[p("Top produtos mais movimentados",-1)])]),content:i(()=>[s(a(h),{value:R.value,loading:f.value,size:"small",class:"w-full"},{default:i(()=>[s(a(l),{field:"nome",header:"Produto"}),s(a(l),{field:"sku",header:"SKU",style:{width:"160px"}}),s(a(l),{field:"total",header:"Movimentado",style:{width:"150px"}})]),_:1},8,["value","loading"])]),_:1}),s(a(v),null,{title:i(()=>[...t[9]||(t[9]=[p("Produtos por categoria",-1)])]),content:i(()=>[s(a(h),{value:B.value,loading:f.value,size:"small",class:"w-full"},{default:i(()=>[s(a(l),{field:"nome",header:"Categoria"}),s(a(l),{field:"quantidade",header:"Quantidade",style:{width:"140px"}})]),_:1},8,["value","loading"]),t[10]||(t[10]=r("div",{class:"text-xs text-slate-500 mt-2"}," Quando um produto não possui categoria, ele aparece como “Sem categoria”. ",-1))]),_:1})]),s(a(v),null,{title:i(()=>[...t[11]||(t[11]=[p("Movimentos recentes",-1)])]),content:i(()=>[s(a(h),{value:Q.value,loading:f.value,size:"small",class:"w-full"},{default:i(()=>[s(a(l),{field:"id",header:"ID",style:{width:"90px"}}),s(a(l),{header:"Produto"},{body:i(({data:e})=>[p(u(e.nome_do_produto),1)]),_:1}),s(a(l),{field:"quantidade",header:"Quantidade",style:{width:"140px"}}),s(a(l),{header:"Motivo",style:{width:"150px"}},{body:i(({data:e})=>[s(a(U),{value:e.motivo,severity:C(e.motivo)},null,8,["value","severity"])]),_:1}),s(a(l),{field:"tipo",header:"Tipo",style:{width:"220px"}}),s(a(l),{header:"Data",style:{width:"190px"}},{body:i(({data:e})=>[p(u(k(e.criado_em)),1)]),_:1})]),_:1},8,["value","loading"])]),_:1}),s(a(H))]))}},Yt=V(et,[["__scopeId","data-v-b3c02b39"]]);export{Yt as default};
