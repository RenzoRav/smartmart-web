import{_ as R,e as A,p as D,r as v,g as F,f as M,c as k,a as d,b as t,h as s,w,o as $,k as P}from"#entry";import j from"./DD2qQycl.js";import x from"./BQz5Vwi_.js";import y from"./Bq2pbc1y.js";import T from"./DhDNEnE0.js";import E from"./B_p5YFW3.js";import K from"./C8ybefJq.js";import O from"./qTLsQgqi.js";import G from"./DnN3s99Q.js";import H from"./NDFfCbvq.js";import J from"./yc0ifDaG.js";import{u as Q}from"./NV_IPBJU.js";import"./CSQXBnP7.js";import"./B8EF_KF5.js";import"./vmQW3Ir0.js";import"./78XFv97U.js";import"./BDJlFfOO.js";import"./CkvWrF-X.js";import"./BrZ4R6i-.js";import"./BSONcgAy.js";import"./jc0MLXVe.js";import"./Bw4qCRz7.js";import"./CLs7nh7g.js";import"./BBwxp7DA.js";import"./0leCDpo6.js";import"./CqWfnscF.js";import"./5MdJC5N0.js";import"./CoLlQPlp.js";import"./CHHeVdlX.js";import"./Cei_Azhi.js";import"./B7vGS5x1.js";import"./BTAX5_q6.js";import"./CJNK_OEZ.js";import"./60u9rO5t.js";import"./D_SYk5Yd.js";import"./ZhWAdK_X.js";import"./BCUjEuon.js";import"./DL66d3kA.js";import"./D2oKIKod.js";import"./B4fJAez9.js";import"./B9cle0o0.js";import"./BTHrrjOC.js";import"./lc9TpMTh.js";import"./Dlgc9DXr.js";import"./DnPw_2K1.js";import"./ByRvq9lQ.js";import"./gPgZW9Jk.js";import"./BZmF0YU-.js";import"./BhIdB9yW.js";import"./DEj1BPjW.js";import"./yTSd6_KT.js";import"./Cvz18dE1.js";import"./CUFmKAPc.js";function W(){const p=Q(),n="usuarios";return{listar:async()=>{const{data:l,error:i}=await p.from(n).select("*");if(i)throw i;return l},buscar:async l=>{const{data:i,error:m}=await p.from(n).select("*").eq("id",l).single();if(m)throw m;return i},criar:async l=>{const{data:i,error:m}=await p.from(n).insert([l]).select();if(m)throw m;return i[0]},atualizar:async(l,i)=>{const{data:m,error:c}=await p.from(n).update(i).eq("id",l).select();if(c)throw c;return m[0]},excluir:async l=>{const{error:i}=await p.from(n).delete().eq("id",l);if(i)throw i;return!0}}}const X={class:"max-w-none mx-auto px-8"},Y={class:"flex items-center justify-between mb-5"},Z={class:"flex items-center gap-2"},ee={class:"flex gap-2"},ae={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},oe={class:"md:col-span-2"},re={key:0,class:"text-slate-500"},te={class:"flex justify-end gap-2"},se={__name:"index",setup(p){const n=A(),g=D(),{listar:h,criar:C,atualizar:V,excluir:U}=W(),l=v(!1),i=v([]),m=v(""),c=v(!1),f=v(!1),S=[{rotulo:"ADMIN",valor:"ADMIN"},{rotulo:"USER",valor:"USER"}],u=v({id:null,username:"",password:"",role:"USER"}),_=F(()=>{const o=m.value.trim().toLowerCase();return o?i.value.filter(a=>[a.username,a.role].some(r=>String(r??"").toLowerCase().includes(o))):i.value});async function b(){try{l.value=!0,i.value=await h()}catch(o){B("Falha ao carregar usuários",o)}finally{l.value=!1}}function N(){f.value=!1,u.value={id:null,username:"",password:"",role:"USER"},c.value=!0}function z(o){f.value=!0,u.value={id:o.id,username:o.username||"",password:"",role:o.role||"USER"},c.value=!0}async function I(){try{const o={username:String(u.value.username||"").trim(),role:u.value.role};if(!o.username){n.add({severity:"warn",summary:"Validação",detail:"Informe o nome de usuário.",life:3e3});return}if(f.value){const a=String(u.value.password||"").trim();a&&(o.password=a),await V(u.value.id,o),n.add({severity:"success",summary:"Atualizado",detail:"Usuário atualizado.",life:2500})}else{const a=String(u.value.password||"").trim();if(!a){n.add({severity:"warn",summary:"Validação",detail:"Informe a senha.",life:3e3});return}o.password=a,await C(o),n.add({severity:"success",summary:"Criado",detail:"Usuário criado.",life:2500})}c.value=!1,await b()}catch(o){o("Falha ao salvar usuário",o)}}function q(o){g.require({message:`Excluir o usuário "${o.username}"?`,header:"Confirmar exclusão",icon:"pi pi-exclamation-triangle",acceptLabel:"Excluir",rejectLabel:"Cancelar",acceptClass:"p-button-danger",accept:async()=>{try{await U(o.id),n.add({severity:"success",summary:"Excluído",detail:"Usuário excluído.",life:2500}),await b()}catch(a){a("Falha ao excluir usuário",a)}}})}function B(o,a){const r=a?.message||a?.details||a?.hint||(typeof e=="string"?a:"Tente novamente.");n.add({severity:"error",summary:"Erro",detail:`${o}: ${r}`,life:5e3}),console.error(a)}return M(b),(o,a)=>($(),k("div",X,[d("div",Y,[a[6]||(a[6]=d("h1",{class:"text-2xl font-bold"},"Usuários",-1)),d("div",Z,[t(s(E),{modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=r=>m.value=r),placeholder:"Buscar por usuário ou papel",class:"w-72 md:w-96"},null,8,["modelValue"]),t(s(y),{label:"Novo usuário",icon:"pi pi-plus",onClick:N})])]),t(s(j),{value:_.value,loading:l.value,dataKey:"id",paginator:"",rows:10,rowsPerPageOptions:[10,20,50,100],size:"small",class:"shadow-sm rounded-lg w-full",style:{width:"100%"}},{default:w(()=>[t(s(x),{field:"id",header:"ID",style:{width:"90px"}}),t(s(x),{field:"username",header:"Usuário"}),t(s(x),{header:"Papel",style:{width:"180px"}},{body:w(({data:r})=>[t(s(J),{value:r.role||"—"},null,8,["value"])]),_:1}),t(s(x),{header:"Ações",style:{width:"160px"}},{body:w(({data:r})=>[d("div",ee,[t(s(y),{icon:"pi pi-pencil",severity:"secondary",outlined:"",onClick:L=>z(r)},null,8,["onClick"]),t(s(y),{icon:"pi pi-trash",severity:"danger",outlined:"",onClick:L=>q(r)},null,8,["onClick"])])]),_:1})]),_:1},8,["value","loading"]),t(s(T),{visible:c.value,"onUpdate:visible":a[5]||(a[5]=r=>c.value=r),header:f.value?"Editar usuário":"Novo usuário",modal:"",class:"w-full md:w-2/3 lg:w-1/2"},{footer:w(()=>[d("div",te,[t(s(y),{label:"Cancelar",severity:"secondary",outlined:"",onClick:a[4]||(a[4]=r=>c.value=!1)}),t(s(y),{label:f.value?"Salvar":"Criar",icon:"pi pi-check",onClick:I},null,8,["label"])])]),default:w(()=>[d("div",ae,[d("div",oe,[a[7]||(a[7]=d("label",{class:"block text-sm mb-1"},"Usuário",-1)),t(s(E),{modelValue:u.value.username,"onUpdate:modelValue":a[1]||(a[1]=r=>u.value.username=r),modelModifiers:{trim:!0},placeholder:"Nome de usuário",class:"w-full"},null,8,["modelValue"])]),d("div",null,[a[8]||(a[8]=d("label",{class:"block text-sm mb-1"},"Senha",-1)),t(s(K),{modelValue:u.value.password,"onUpdate:modelValue":a[2]||(a[2]=r=>u.value.password=r),feedback:!1,"toggle-mask":"",fluid:"","input-props":{placeholder:"Senha"}},null,8,["modelValue"]),f.value?($(),k("small",re,"Deixe em branco para manter a senha atual.")):P("",!0)]),d("div",null,[a[9]||(a[9]=d("label",{class:"block text-sm mb-1"},"Papel",-1)),t(s(O),{modelValue:u.value.role,"onUpdate:modelValue":a[3]||(a[3]=r=>u.value.role=r),options:S,optionLabel:"rotulo",optionValue:"valor",class:"w-full"},null,8,["modelValue"])])])]),_:1},8,["visible","header"]),t(s(G)),t(s(H))]))}},sa=R(se,[["__scopeId","data-v-05f1df92"]]);export{sa as default};
