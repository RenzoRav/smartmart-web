import{_ as R,e as A,l as D,r as w,g as F,h as M,c as k,a as u,b as t,m as s,w as y,o as $,i as P}from"#entry";import j from"./BEBcsuY7.js";import b from"./4E9mHiY7.js";import x from"./B5Rp8oPm.js";import T from"./Dp1NHfWm.js";import E from"./CTveXR6O.js";import K from"./CLE4xZur.js";import O from"./B5IYq4Vu.js";import G from"./BDrtuTeG.js";import H from"./B3E57TI-.js";import J from"./C1G497qJ.js";import{u as Q}from"./CyzKzsh0.js";import"./CoLSyHkG.js";import"./BA96TlVT.js";import"./cpzgCRYL.js";import"./CTjfiFnN.js";import"./Bmmxouqf.js";import"./C-P4eG7R.js";import"./G7qAH3-S.js";import"./C5ynMuxg.js";import"./jc0MLXVe.js";import"./CJskYxiL.js";import"./CLs7nh7g.js";import"./vwQloIhU.js";import"./CXKsnyIn.js";import"./DA4wmwat.js";import"./xT-WVbYN.js";import"./CjBpjVDB.js";import"./COuM4AeE.js";import"./CIubQrV5.js";import"./CJOrG8sJ.js";import"./ChBKel9d.js";import"./BMbmrZjI.js";import"./CsaQjRGF.js";import"./BJHql7T7.js";import"./ZhWAdK_X.js";import"./CCciSrqF.js";import"./BIt-I3sC.js";import"./C_hlOuOa.js";import"./CLh_-5oz.js";import"./JYNMDp6K.js";import"./C1DPygkB.js";import"./BV7_1V5A.js";import"./CrpQQ2Ce.js";import"./DGWfkXqg.js";import"./Bljkj9EE.js";import"./DkzIYpue.js";import"./8jk2_tQ3.js";import"./CiNVQzof.js";import"./DEj1BPjW.js";import"./Kaizc2Sq.js";import"./CZjQcvlU.js";import"./BdQ_wlQu.js";function W(){const c=Q();return{listar:async()=>{const{data:n,error:i}=await c.from("users").select("*");if(i)throw i;return n},buscar:async n=>{const{data:i,error:d}=await c.from("users").select("*").eq("id",n).single();if(d)throw d;return i},criar:async n=>{const{data:i,error:d}=await c.from("users").insert([n]).select();if(d)throw d;return i[0]},atualizar:async(n,i)=>{const{data:d,error:p}=await c.from("users").update(i).eq("id",n).select();if(p)throw p;return d[0]},excluir:async n=>{const{error:i}=await c.from("users").delete().eq("id",n);if(i)throw i;return!0}}}const X={class:"max-w-none mx-auto px-8"},Y={class:"flex items-center justify-between mb-5"},Z={class:"flex items-center gap-2"},ee={class:"flex gap-2"},ae={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},re={class:"md:col-span-2"},oe={key:0,class:"text-slate-500"},te={class:"flex justify-end gap-2"},se={__name:"index",setup(c){const m=A(),h=D(),{listar:C,criar:V,atualizar:U,excluir:n}=W(),i=w(!1),d=w([]),p=w(""),f=w(!1),v=w(!1),S=[{rotulo:"ADMIN",valor:"ADMIN"},{rotulo:"USER",valor:"USER"}],l=w({id:null,username:"",password:"",role:"USER"}),_=F(()=>{const r=p.value.trim().toLowerCase();return r?d.value.filter(a=>[a.username,a.role].some(o=>String(o??"").toLowerCase().includes(r))):d.value});async function g(){try{i.value=!0,d.value=await C()}catch(r){B("Falha ao carregar usuários",r)}finally{i.value=!1}}function N(){v.value=!1,l.value={id:null,username:"",password:"",role:"USER"},f.value=!0}function z(r){v.value=!0,l.value={id:r.id,username:r.username||"",password:"",role:r.role||"USER"},f.value=!0}async function I(){try{const r={username:String(l.value.username||"").trim(),role:l.value.role};if(!r.username){m.add({severity:"warn",summary:"Validação",detail:"Informe o nome de usuário.",life:3e3});return}if(v.value){const a=String(l.value.password||"").trim();a&&(r.password=a),await U(l.value.id,r),m.add({severity:"success",summary:"Atualizado",detail:"Usuário atualizado.",life:2500})}else{const a=String(l.value.password||"").trim();if(!a){m.add({severity:"warn",summary:"Validação",detail:"Informe a senha.",life:3e3});return}r.password=a,await V(r),m.add({severity:"success",summary:"Criado",detail:"Usuário criado.",life:2500})}f.value=!1,await g()}catch(r){r("Falha ao salvar usuário",r)}}function q(r){h.require({message:`Excluir o usuário "${r.username}"?`,header:"Confirmar exclusão",icon:"pi pi-exclamation-triangle",acceptLabel:"Excluir",rejectLabel:"Cancelar",acceptClass:"p-button-danger",accept:async()=>{try{await n(r.id),m.add({severity:"success",summary:"Excluído",detail:"Usuário excluído.",life:2500}),await g()}catch(a){a("Falha ao excluir usuário",a)}}})}function B(r,a){const o=a?.message||a?.details||a?.hint||(typeof e=="string"?a:"Tente novamente.");m.add({severity:"error",summary:"Erro",detail:`${r}: ${o}`,life:5e3}),console.error(a)}return M(g),(r,a)=>($(),k("div",X,[u("div",Y,[a[6]||(a[6]=u("h1",{class:"text-2xl font-bold"},"Usuários",-1)),u("div",Z,[t(s(E),{modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=o=>p.value=o),placeholder:"Buscar por usuário ou papel",class:"w-72 md:w-96"},null,8,["modelValue"]),t(s(x),{label:"Novo usuário",icon:"pi pi-plus",onClick:N})])]),t(s(j),{value:_.value,loading:i.value,dataKey:"id",paginator:"",rows:10,rowsPerPageOptions:[10,20,50,100],size:"small",class:"shadow-sm rounded-lg w-full",style:{width:"100%"}},{default:y(()=>[t(s(b),{field:"id",header:"ID",style:{width:"90px"}}),t(s(b),{field:"username",header:"Usuário"}),t(s(b),{header:"Papel",style:{width:"180px"}},{body:y(({data:o})=>[t(s(J),{value:o.role||"—"},null,8,["value"])]),_:1}),t(s(b),{header:"Ações",style:{width:"160px"}},{body:y(({data:o})=>[u("div",ee,[t(s(x),{icon:"pi pi-pencil",severity:"secondary",outlined:"",onClick:L=>z(o)},null,8,["onClick"]),t(s(x),{icon:"pi pi-trash",severity:"danger",outlined:"",onClick:L=>q(o)},null,8,["onClick"])])]),_:1})]),_:1},8,["value","loading"]),t(s(T),{visible:f.value,"onUpdate:visible":a[5]||(a[5]=o=>f.value=o),header:v.value?"Editar usuário":"Novo usuário",modal:"",class:"w-full md:w-2/3 lg:w-1/2"},{footer:y(()=>[u("div",te,[t(s(x),{label:"Cancelar",severity:"secondary",outlined:"",onClick:a[4]||(a[4]=o=>f.value=!1)}),t(s(x),{label:v.value?"Salvar":"Criar",icon:"pi pi-check",onClick:I},null,8,["label"])])]),default:y(()=>[u("div",ae,[u("div",re,[a[7]||(a[7]=u("label",{class:"block text-sm mb-1"},"Usuário",-1)),t(s(E),{modelValue:l.value.username,"onUpdate:modelValue":a[1]||(a[1]=o=>l.value.username=o),modelModifiers:{trim:!0},placeholder:"Nome de usuário",class:"w-full"},null,8,["modelValue"])]),u("div",null,[a[8]||(a[8]=u("label",{class:"block text-sm mb-1"},"Senha",-1)),t(s(K),{modelValue:l.value.password,"onUpdate:modelValue":a[2]||(a[2]=o=>l.value.password=o),feedback:!1,"toggle-mask":"",fluid:"","input-props":{placeholder:"Senha"}},null,8,["modelValue"]),v.value?($(),k("small",oe,"Deixe em branco para manter a senha atual.")):P("",!0)]),u("div",null,[a[9]||(a[9]=u("label",{class:"block text-sm mb-1"},"Papel",-1)),t(s(O),{modelValue:l.value.role,"onUpdate:modelValue":a[3]||(a[3]=o=>l.value.role=o),options:S,optionLabel:"rotulo",optionValue:"valor",class:"w-full"},null,8,["modelValue"])])])]),_:1},8,["visible","header"]),t(s(G)),t(s(H))]))}},sa=R(se,[["__scopeId","data-v-05f1df92"]]);export{sa as default};
