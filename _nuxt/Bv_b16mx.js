import{_ as K,e as G,p as H,r as c,g as W,f as X,c as Y,a as r,b as i,h as a,w as p,o as Z,t as D,d as oo}from"#entry";import to from"./DD2qQycl.js";import v from"./BQz5Vwi_.js";import g from"./Bq2pbc1y.js";import eo from"./DhDNEnE0.js";import I from"./qTLsQgqi.js";import io from"./BCUjEuon.js";import ao from"./B_p5YFW3.js";import ro from"./DnN3s99Q.js";import lo from"./NDFfCbvq.js";import $ from"./yc0ifDaG.js";import{u as no}from"./NV_IPBJU.js";import{u as so}from"./ENU34LCR.js";import"./CSQXBnP7.js";import"./B8EF_KF5.js";import"./vmQW3Ir0.js";import"./78XFv97U.js";import"./BDJlFfOO.js";import"./CkvWrF-X.js";import"./BrZ4R6i-.js";import"./BSONcgAy.js";import"./jc0MLXVe.js";import"./Bw4qCRz7.js";import"./CLs7nh7g.js";import"./BBwxp7DA.js";import"./0leCDpo6.js";import"./CqWfnscF.js";import"./5MdJC5N0.js";import"./CoLlQPlp.js";import"./CHHeVdlX.js";import"./Cei_Azhi.js";import"./B7vGS5x1.js";import"./BTAX5_q6.js";import"./CJNK_OEZ.js";import"./60u9rO5t.js";import"./D_SYk5Yd.js";import"./ZhWAdK_X.js";import"./B4fJAez9.js";import"./B9cle0o0.js";import"./BTHrrjOC.js";import"./lc9TpMTh.js";import"./Dlgc9DXr.js";import"./DnPw_2K1.js";import"./ByRvq9lQ.js";import"./gPgZW9Jk.js";import"./BZmF0YU-.js";import"./BhIdB9yW.js";import"./DEj1BPjW.js";import"./DL66d3kA.js";import"./D2oKIKod.js";import"./Cvz18dE1.js";import"./CUFmKAPc.js";function uo(){const x=no();return{listar:async()=>{const{data:s,error:n}=await x.from("movimentos_estoque").select("*");if(n)throw n;return s},criar:async s=>{const n={produto_id:s.produto_id??s.produto?.id,quantidade:s.quantidade,tipo:s.tipo,motivo:s.motivo},{data:b,error:m}=await x.from("movimentos_estoque").insert([n]).select();if(m)throw m;return b[0]},atualizar:async(s,n)=>{const b={produto_id:n.produto_id??n.produto?.id,quantidade:n.quantidade,tipo:n.tipo,motivo:n.motivo},{data:m,error:f}=await x.from("movimentos_estoque").update(b).eq("id",s).select();if(f)throw f;return m[0]},excluir:async s=>{const{error:n}=await x.from("movimentos_estoque").delete().eq("id",s);if(n)throw n;return!0}}}const mo={class:"max-w-none mx-auto px-8"},po={class:"flex items-center justify-between mb-5"},co={class:"flex items-center gap-2"},vo={class:"flex flex-col"},fo={class:"font-medium"},yo={class:"text-xs text-slate-500"},wo={class:"flex gap-2"},xo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},bo={class:"flex justify-end gap-2"},_o={__name:"index",setup(x){const d=G(),M=H(),{listar:N,criar:k,atualizar:s,excluir:n}=uo(),{listar:b}=so(),m=c(!1),f=c([]),V=c([]),h=c(""),y=c(!1),_=c(!1),l=c({id:null,produtoId:null,quantidade:1,tipo:"",motivo:""}),T=[{rotulo:"Compra fornecedor",valor:"COMPRA_FORNECEDOR"},{rotulo:"Venda",valor:"VENDA"},{rotulo:"Devolução cliente",valor:"DEVOLUCAO_CLIENTE"},{rotulo:"Ajuste de estoque",valor:"AJUSTE_ESTOQUE"},{rotulo:"Perda",valor:"PERDA"},{rotulo:"Vencimento",valor:"VENCIMENTO"}],L=[{rotulo:"Entrada",valor:"ENTRADA"},{rotulo:"Saída",valor:"SAIDA"}];function R(o){const t=T.find(e=>e.valor===o);return t?t.rotulo:o||"—"}function U(o){return o==="ENTRADA"?"Entrada":o==="SAIDA"?"Saída":o||"—"}function B(o){return o==="ENTRADA"?"success":o==="SAIDA"?"danger":"secondary"}function w(o){return o?typeof o=="string"?o:typeof o=="object"&&(o.name||o.valor||o.tipo)||"":""}function C(o){return w(o.tipo)||w(o.tipoMovimento)||w(o.tipo_movimento)}function E(o){return w(o.motivo)||w(o.motivoMovimento)||w(o.motivo_movimento)}function O(o){const t=o||"",u=t||null||null,A=u?new Date(u):null;if(!A||isNaN(A))return t||"—";try{return new Intl.DateTimeFormat("pt-BR",{dateStyle:"short",timeStyle:"short"}).format(A)}catch{return t||"—"}}const P=W(()=>{const o=h.value.trim().toLowerCase();return o?f.value.filter(t=>[t.produto?.nome,t.produto?.sku,C(t),E(t)].some(e=>String(e??"").toLowerCase().includes(o))):f.value});function z(){const o=new Map;for(const t of V.value)o.set(t.id,t);return o}async function q(){try{m.value=!0;const[o,t]=await Promise.all([b(),N()]);V.value=o||[];const e=z();f.value=(t||[]).map(u=>({...u,produto:u.produto??e.get(u.produto_id??u.produtoId)??null,criadoEm:u.criadoEm??u.criado_em??u.created_at??null}))}catch(o){S("Falha ao carregar dados",o)}finally{m.value=!1}}function F(){_.value=!1,l.value={id:null,produtoId:null,quantidade:1,tipo:"",motivo:""},y.value=!0}function j(o){_.value=!0,l.value={id:o.id,produtoId:o.produto?.id??o.produto_id??null,quantidade:Number(o.quantidade??1),tipo:C(o),motivo:E(o)},y.value=!0}async function Q(){try{const o={produto_id:l.value.produtoId,quantidade:Number(l.value.quantidade),tipo:l.value.tipo,motivo:l.value.motivo};if(!o.produto_id){d.add({severity:"warn",summary:"Validação",detail:"Selecione um produto.",life:3e3});return}if(!o.tipo){d.add({severity:"warn",summary:"Validação",detail:"Selecione um tipo.",life:3e3});return}if(!o.motivo){d.add({severity:"warn",summary:"Validação",detail:"Selecione o motivo.",life:3e3});return}_.value&&l.value.id?(await s(l.value.id,o),d.add({severity:"success",summary:"Atualizado",detail:"Movimento atualizado com sucesso.",life:2500})):(await k(o),d.add({severity:"success",summary:"Criado",detail:"Movimento criado com sucesso.",life:2500})),y.value=!1,await q()}catch(o){S("Falha ao salvar movimento",o)}}function J(o){M.require({message:`Excluir o movimento do produto "${o.produto?.nome??"produto"}"?`,header:"Confirmar exclusão",icon:"pi pi-exclamation-triangle",acceptLabel:"Excluir",rejectLabel:"Cancelar",acceptClass:"p-button-danger",accept:async()=>{try{await n(o.id),d.add({severity:"success",summary:"Excluído",detail:"Movimento excluído.",life:2500}),await q()}catch(t){S("Falha ao excluir movimento",t)}}})}function S(o,t){const e=t?.message||t?.details||t?.hint||(typeof t=="string"?t:"Tente novamente.");d.add({severity:"error",summary:"Erro",detail:`${o}: ${e}`,life:5e3}),console.error(t)}return X(q),(o,t)=>(Z(),Y("div",mo,[r("div",po,[t[7]||(t[7]=r("h1",{class:"text-2xl font-bold"},"Movimentos de Estoque",-1)),r("div",co,[i(a(ao),{modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=e=>h.value=e),placeholder:"Buscar por produto, tipo ou motivo",class:"w-80"},null,8,["modelValue"]),i(a(g),{label:"Novo movimento",icon:"pi pi-plus",onClick:F})])]),i(a(to),{value:P.value,loading:m.value,dataKey:"id",paginator:"",rows:10,rowsPerPageOptions:[10,20,50,100],size:"small",class:"shadow-sm rounded-lg w-full",style:{width:"100%"}},{default:p(()=>[i(a(v),{field:"id",header:"ID",style:{width:"90px"}}),i(a(v),{header:"Produto"},{body:p(({data:e})=>[r("div",vo,[r("span",fo,D(e.produto?.nome||"—"),1),r("span",yo,D(e.produto?.sku||""),1)])]),_:1}),i(a(v),{field:"quantidade",header:"Quantidade",style:{width:"140px"}}),i(a(v),{header:"Tipo",style:{width:"220px"}},{body:p(({data:e})=>[i(a($),{value:R(C(e))},null,8,["value"])]),_:1}),i(a(v),{header:"Motivo",style:{width:"180px"}},{body:p(({data:e})=>[i(a($),{value:U(E(e)),severity:B(E(e))},null,8,["value","severity"])]),_:1}),i(a(v),{header:"Criado em",style:{width:"190px"}},{body:p(({data:e})=>[oo(D(O(e.criadoEm||e.created_at)),1)]),_:1}),i(a(v),{header:"Ações",style:{width:"160px"}},{body:p(({data:e})=>[r("div",wo,[i(a(g),{icon:"pi pi-pencil",severity:"secondary",outlined:"",onClick:u=>j(e)},null,8,["onClick"]),i(a(g),{icon:"pi pi-trash",severity:"danger",outlined:"",onClick:u=>J(e)},null,8,["onClick"])])]),_:1})]),_:1},8,["value","loading"]),i(a(eo),{visible:y.value,"onUpdate:visible":t[6]||(t[6]=e=>y.value=e),header:_.value?"Editar movimento":"Novo movimento",modal:"",class:"w-full md:w-2/3 lg:w-1/2"},{footer:p(()=>[r("div",bo,[i(a(g),{label:"Cancelar",severity:"secondary",outlined:"",onClick:t[5]||(t[5]=e=>y.value=!1)}),i(a(g),{label:_.value?"Salvar":"Criar",icon:"pi pi-check",onClick:Q},null,8,["label"])])]),default:p(()=>[r("div",xo,[r("div",null,[t[8]||(t[8]=r("label",{class:"block text-sm mb-1"},"Produto",-1)),i(a(I),{modelValue:l.value.produtoId,"onUpdate:modelValue":t[1]||(t[1]=e=>l.value.produtoId=e),options:V.value,optionLabel:"nome",optionValue:"id",placeholder:"Selecione um produto",class:"w-full"},null,8,["modelValue","options"])]),r("div",null,[t[9]||(t[9]=r("label",{class:"block text-sm mb-1"},"Quantidade",-1)),i(a(io),{modelValue:l.value.quantidade,"onUpdate:modelValue":t[2]||(t[2]=e=>l.value.quantidade=e),min:1,showButtons:"",class:"w-full"},null,8,["modelValue"])]),r("div",null,[t[10]||(t[10]=r("label",{class:"block text-sm mb-1"},"Tipo",-1)),i(a(I),{modelValue:l.value.tipo,"onUpdate:modelValue":t[3]||(t[3]=e=>l.value.tipo=e),options:T,optionLabel:"rotulo",optionValue:"valor",placeholder:"Selecione o tipo",class:"w-full"},null,8,["modelValue"])]),r("div",null,[t[11]||(t[11]=r("label",{class:"block text-sm mb-1"},"Motivo",-1)),i(a(I),{modelValue:l.value.motivo,"onUpdate:modelValue":t[4]||(t[4]=e=>l.value.motivo=e),options:L,optionLabel:"rotulo",optionValue:"valor",placeholder:"Selecione o motivo",class:"w-full"},null,8,["modelValue"])])])]),_:1},8,["visible","header"]),i(a(ro)),i(a(lo))]))}},bt=K(_o,[["__scopeId","data-v-898bcd4d"]]);export{bt as default};
